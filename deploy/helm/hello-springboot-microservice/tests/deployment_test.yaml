suite: test my deployment
templates:
  - deployment.yaml
release:
  name: my-release
tests:
  - it: meta data
    asserts:
      - containsDocument:
          kind: Deployment
          apiVersion: apps/v1
      - equal:
          path: metadata.name
          value: my-release-hello-springboot-microservice
  - it: template
    set:
      deployment.image.tag: 1.0.99
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: my-release-hello-springboot-microservice
      - equal:
          path: spec.template.spec.containers[0].name
          value: hello-springboot-microservice
      - equal:
          path: spec.template.spec.containers[0].image
          value: siakhooi/hello-springboot-microservice:1.0.99
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: IfNotPresent
  - it: imagePullPolicy
    set:
      deployment.image.pullPolicy: Always
    asserts:
      - equal:
          path: spec.template.spec.containers[0].imagePullPolicy
          value: Always

